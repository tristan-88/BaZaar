from app.models import (db, Product)
import requests
import os
import random
from dotenv import load_dotenv
load_dotenv()



listIds = [1036057741, 1024649137, 1010138716, 564876397, 494711070, 1011911440, 1022102392, 775573306, 835103951, 509482388, 1011364924, 1010595660, 648471774, 1025344383, 1024544055, 1011924746, 646695837, 1010301757, 852920049, 155725160, 830532976, 1017788962, 1022102194, 1024183341, 1036056167, 1021166885, 870990984, 1025259327, 1025256847, 1036059125, 1036059129, 714371154, 721596913, 938011187, 1031720601, 1036046319, 1022016035, 1021168021, 1024558821, 1024176867, 89868586, 1022102116, 1019518664, 1020709033, 864280249, 749800911, 992488859, 1025334919, 961326038, 720509554, 1033480077, 739102814, 230236122, 995544601, 996300365, 710798507, 1033487603, 852617548, 982332904, 1027800497, 1034601263, 832574243, 1031757589, 989348186, 899304438, 1006078072, 1015707815, 971651059, 655487009, 1022102026, 992989961, 472573944, 489831017, 1021129398, 896964500, 933625828, 989180028, 655517661, 908398334, 578845682, 939656827, 874882504, 628636102, 850138872, 997881585, 869778359, 930576891, 787990896, 1036058929, 962653855, 841133629, 619630576, 910006782, 219156670, 192860587, 840738176, 877064911, 781058791, 882685910, 863147700, 1036057741, 1036057741]

API_KEY = os.getenv('API_SECRET_KEY')


def seed_products():
    i = 1
    while i < len(listIds) - 1:
        response = requests.get(
            f'https://openapi.etsy.com/v2/listings/{listIds[i]}/?api_key={API_KEY}')
        data = response.json()
        listings = data['results']
        for item in listings:
            demo = Product(
                name=item["title"],
                store_id=(i/20)+1,
                price=random.uniform(1.99,99.99),
                quantity=item["quantity"],
                description=item["description"],
            )
            db.session.add(demo)
        i += 1
    db.session.commit()


def undo_products():
    db.session.execute('TRUNCATE products RESTART IDENTITY CASCADE;')
    db.session.commit()
