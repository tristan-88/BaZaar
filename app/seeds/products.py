from app.models import (db, Product)
import requests
import os
import random
from dotenv import load_dotenv
load_dotenv()


listIds = [922970172, 701334225, 968327533, 921238644, 690793509, 1020122806, 964802120, 1020147274, 953206278, 1020135506, 1029928999, 1010840284, 928207135, 257206674, 1020147148, 1031009449, 970860922, 867332050, 557889766, 1025292171, 926035755, 995312438, 768257670, 605991338, 1034106391, 1034106407, 845781080, 1020147040, 156198013, 1026346661, 977096288, 877776701, 1014713311, 1006956588, 1034074067, 866512196, 649085936, 697773320, 921081736, 655421487, 976366434, 830826595, 963551810, 684862435, 855635433, 955524218, 1028996381, 757186184, 823669040, 902134439, 1034106327, 946953702, 875512769, 762758670, 1018569097, 895155195, 178598806, 612134575, 1034106293, 213687326, 962125053, 682936099, 636614928, 730236432, 889373541, 765333016, 937131527, 898356995, 1020146934, 831065745, 1034106247, 925454428, 849432136, 1020146920, 752260616, 691645031, 807826998, 756078496, 1009904250, 1034106229, 801803473, 703184802, 835038799, 948369154, 1034106215, 531558592, 1034106203, 787664706, 869662850, 1023014429, 893652313, 900670791, 956636154, 1034106197, 932222938, 989703034, 772601146, 632924296, 1034106185, 831761824, 922970172, 922970172]

API_KEY = os.getenv('API_SECRET_KEY')


def seed_products():
    i = 1
    while i < len(listIds) - 1:
        response = requests.get(
            f'https://openapi.etsy.com/v2/listings/{listIds[i]}/?api_key={API_KEY}')
        data = response.json()
        listings = data['results']
        for item in listings:
            demo = Product(
                name=item["title"],
                store_id=(i/20)+1,
                price=random.uniform(1.99,99.99),
                quantity=item["quantity"],
                description=item["description"],
            )
            db.session.add(demo)
        i += 1
    db.session.commit()


def undo_products():
    db.session.execute('TRUNCATE products RESTART IDENTITY CASCADE;')
    db.session.commit()
