from app.models import (db, Product)
import requests
import os
import random
from dotenv import load_dotenv
load_dotenv()


listIds = [1016640732, 992201667, 723807955, 869496073, 986244432, 666379785, 920918719, 1016642888, 801630702, 1030607951, 885979205, 986064487, 1016642858, 1004811264, 524357606, 858714308, 733468130, 1015593434, 1030041157, 706896331, 965758867, 780518900, 675285656, 828564966, 1016642838, 1004348430, 703034447, 1001419729, 801560954, 992190868, 263521350, 871744317, 773356673, 995431337, 832372873, 995389379, 1030607863, 765369714, 1015853160, 954317747, 940368782, 814109658, 854281576, 1016642770, 835311939, 941253447, 1015531978, 889185459, 1015510280, 179873548, 1015516198, 1015537478, 828357692, 888436615, 1016126092, 836277848, 938266375, 965405688, 209844607, 804236081, 941191180, 1030606005, 960692167, 1008966506, 1015952382, 275163168, 1016642714, 1012288393, 1030607799, 940352538, 974231624, 865085280, 773531645, 1028879533, 959125746, 595072431, 817618201, 846845422, 947417028, 674293923, 1016587722, 788433167, 225140261, 965755735, 73506744, 166462394, 902649459, 1030607783, 675385223, 592353064, 973363976, 777500157, 930332785, 733426969, 1016642682, 973285081, 1005763126, 1011226204, 819837973, 929593577, 1016640732, 1016640732]
API_KEY = os.getenv('API_SECRET_KEY')


def seed_products():
    i = 1
    while i < len(listIds) - 1:
        response = requests.get(
            f'https://openapi.etsy.com/v2/listings/{listIds[i]}/?api_key={API_KEY}')
        data = response.json()
        listings = data['results']
        for item in listings:
            demo = Product(
                name=item["title"],
                store_id=(i/20)+1,
                price=random.uniform(1.99,99.99),
                quantity=item["quantity"],
                description=item["description"],
            )
            db.session.add(demo)
        i += 1
    db.session.commit()


def undo_products():
    db.session.execute('TRUNCATE products RESTART IDENTITY CASCADE;')
    db.session.commit()
